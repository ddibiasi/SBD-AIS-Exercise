<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Orderservice Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; color: #222; }
    h1 { margin: 0 0 1rem; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #e5e5e5; padding: 10px 12px; }
    th { background: #f7f7f7; text-align: left; }
    .card { border: 1px solid #eee; border-radius: 12px; padding: 1rem 1.25rem; }
    .row { display: flex; gap: .5rem; align-items: center; }
    .btn { cursor: pointer; padding: .5rem .75rem; border-radius: 8px; border: 1px solid #ccc; background: #fafafa; }
    .btn:hover { background: #f0f0f0; }
    .muted { color: #666; font-size: .9rem; }
    input[type="number"] { padding: .4rem .5rem; border: 1px solid #ccc; border-radius: 6px; }
    #error { color: #b00020; margin-top: .5rem; display: none; }
  </style>
</head>
<body>
  <h1>Orderservice Dashboard</h1>
  <p class="muted">This page talks to the same API you tested: <code>/drinks</code> and <code>/orders</code>.</p>

  <div class="grid">
    <div class="card">
      <h2>Drinks</h2>
      <table id="drinks-table">
        <thead><tr><th>ID</th><th>Name</th><th>Price (€)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Orders</h2>
      <table id="orders-table">
        <thead><tr><th>Order ID</th><th>Drink</th><th>Qty</th><th>Total (€)</th><th>Created</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-top:1.5rem;">
    <h2>Create Order</h2>
    <div class="row" style="margin-bottom:.25rem;">
      <label for="drink">Drink ID:</label>
      <input id="drink" type="number" min="1" value="1" style="width:6rem;" />
      <label for="qty">Qty:</label>
      <input id="qty" type="number" min="1" value="1" style="width:6rem;" />
      <button class="btn" id="create">Create</button>
      <button class="btn" id="refresh">Refresh</button>
    </div>
    <p id="error"></p>
    <p class="muted">Tip: drink IDs are listed in the Drinks table.</p>
  </div>

  <script>
    const euro = cents => (cents/100).toFixed(2);
    const showError = msg => {
      const el = document.getElementById('error');
      el.textContent = msg;
      el.style.display = msg ? 'block' : 'none';
    };

    async function fetchJSON(url, opts={}) {
      const res = await fetch(url, opts);
      if (!res.ok) {
        const text = await res.text().catch(()=>"");
        throw new Error(`${res.status} ${res.statusText} – ${text}`);
      }
      return res.json();
    }

    async function loadDrinks() {
      const data = await fetchJSON('/drinks');
      const tb = document.querySelector('#drinks-table tbody');
      tb.innerHTML = '';
      data.forEach(d => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.ID}</td><td>${d.Name}</td><td>${euro(d.PriceCents)}</td>`;
        tb.appendChild(tr);
      });
    }

    async function loadOrders() {
      const data = await fetchJSON('/orders');
      const tb = document.querySelector('#orders-table tbody');
      tb.innerHTML = '';
      data.forEach(o => {
        const tr = document.createElement('tr');
        const dt = o.CreatedAt ? new Date(o.CreatedAt).toLocaleString() : '';
        tr.innerHTML = `
          <td>${o.OrderID ?? ''}</td>
          <td>${o.DrinkName ?? ''}</td>
          <td>${o.Qty ?? ''}</td>
          <td>${o.LineTotalCents != null ? euro(o.LineTotalCents) : ''}</td>
          <td>${dt}</td>`;
        tb.appendChild(tr);
      });
    }

    async function createOrder() {
      const drink = document.getElementById('drink').value;
      const qty = document.getElementById('qty').value;
      const body = new URLSearchParams({ drink_id: drink, qty });
      await fetch('/orders', { method: 'POST', body });
      await loadOrders();
    }

    document.getElementById('create').addEventListener('click', () => {
      showError('');
      createOrder().catch(e => showError(e.message));
    });
    document.getElementById('refresh').addEventListener('click', () => {
      showError('');
      Promise.all([loadDrinks(), loadOrders()]).catch(e => showError(e.message));
    });

    // Initial load
    Promise.all([loadDrinks(), loadOrders()]).catch(e => showError('Failed to load data: ' + e.message));
  </script>
</body>
</html>
